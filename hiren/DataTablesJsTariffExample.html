<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
 <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="../img/ico.png" sizes="16x16" type="image/ico">        
       
        <!--Load JQuery-->
        <script src="../lib/jquery-3.3.1.js" type="text/javascript"></script> 
       
        <!--Load Bootstrap-->
        <link href="../lib/bootstrap-4.3.1-dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
        <link href="../lib/bootstrap-4.3.1-dist/css/glyphicons.css" rel="stylesheet" type="text/css"/>
        <script src="../lib/bootstrap-4.3.1-dist/js/bootstrap.min.js" type="text/javascript"></script>
        <!--Load D3-->
        <script src="../lib/d3_3.5.17.js" type="text/javascript"></script>
        <!--Load crossfilter-->
        <script src="../lib/crossfilter_1_4_6.js" type="text/javascript"></script>
        
        <!--Load DC-->
        <link href="../lib/dc.js-2.1.10/dc.css" rel="stylesheet" type="text/css"/>
        <script src="../lib/dc.js-2.1.10/dc.js" type="text/javascript"></script>

       <!--Load dataTables-->
         <script src="../lib/data_table_min.js" type="text/javascript"></script>
       
       <!--NOTE: use datatablemin.css else data table icons will not work!--> 
        <link href="../lib/data_tables/DataTables-1.10.18/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css"/>
        
        <link href="../lib/data_tables/searchHighlight/dataTables.searchHighlight.css" rel="stylesheet" type="text/css"/>
        <script src="../lib/data_tables/searchHighlight/dataTables.searchHighlight.min.js" type="text/javascript"></script>                 
       <script src="../lib/data_tables/searchHighlight/jquery_highlight_plugin.js" type="text/javascript"></script>
    
       
       <script src="../lib/data_tables/export/buttons.html5.min.js" type="text/javascript"></script>
       <script src="../lib/data_tables/export/buttons.print.min.js" type="text/javascript"></script>
       <script src="../lib/data_tables/export/dataTables.buttons.min.js" type="text/javascript"></script>
       <script src="../lib/data_tables/export/jszip.min.js" type="text/javascript"></script>
       <script src="../lib/data_tables/export/vfs_fonts.js" type="text/javascript"></script>
                
       <link href="css/myStyle.css" rel="stylesheet" type="text/css"/>
       <script src="data/myds.js"></script>
    </head>        

    <body>
        
        

        <h1>DC.js Dashboard with DataTables.js</h1>
        <button type="button" onClick = "resetData()"> reset </button>
        <!--<button data-toggle="collapse" data-target="#chartsSection">show/hide charts</button>-->
       
        <div id="parentCon" class="row hiren">
            <div class="col-lg-6" id="chart1"> <p class = "chartTitle">Car count by type </p> </div>
            <div class="col-lg-6" id="chart2"> <p class = "chartTitle">Car type by colour</p></div>
        </div>
        
        <div class="row">
            <div class="col-lg-6" id="chart3"> <p class = "chartTitle">Car count by type</p></div>
        </div>
        
       
        
        <!--<button data-toggle="collapse" data-target="#tableSection" >show/hide table</button>-->

      

        <div id="mytable" class="row container-fluid" >
            <div class="col-lg-1"></div>
            
                <div class="col-lg-10">
                <table class="table table-striped table-bordered table-hover" id="alltable" cellspacing="0">
                        <thead>
                                <tr>
                                    <th>Car</th>
                                    <th>Max speed</th>
                                    <th>Colour</th>
                                    <th>Cost</th>
                                    <th>Img</th>
                                   
                                 
                                </tr>
                        </thead>

                        <tbody class="ds_table">
                            
                        </tbody>
                </table>         
                </div>
            <div class="col-lg-1"></div>
            </div> <!--table end-->
       
        <script>
var chart1 = dc.barChart("#chart1");
var chart2 = dc.barChart("#chart2");
var chart3 = dc.pieChart("#chart3");
  
var cf_ds = crossfilter(ds);

//Dimensions
var name_dim = cf_ds.dimension(function(d){return d.car;});
var colour_dim = cf_ds.dimension(function(d){return d.colour;});

var name_dim2 = cf_ds.dimension(function(d){return d.car;});

//Grouping
var name_grp = name_dim.group().reduceCount();
var colour_grp = colour_dim.group().reduceCount();

var name_grp2 = name_dim2.group().reduceCount();

//Chart function 

chart1
    .x(d3.scale.ordinal())
    .xUnits(dc.units.ordinal)     
    .dimension(name_dim)
    .group(name_grp)
    .on("filtered",function(){        
                $("#alltable").DataTable().clear().draw();
                $("#alltable").DataTable().rows.add(name_dim.top(Infinity)).draw();
                })   
;

chart2
    .x(d3.scale.ordinal())
    .xUnits(dc.units.ordinal)     
    .dimension(colour_dim)
    .group(colour_grp)
    .on("filtered",function(){        
                $("#alltable").DataTable().clear().draw();
                $("#alltable").DataTable().rows.add(name_dim.top(Infinity)).draw();
                })
        
;

chart3
//    .width(300)
//    .height(480)
    .slicesCap(4)
    .innerRadius(30)
    .dimension(name_dim2)
    .group(name_grp2)
    .legend(dc.legend())
    .on("filtered",function(){        
                $("#alltable").DataTable().clear().draw();
                $("#alltable").DataTable().rows.add(name_dim2.top(Infinity)).draw();
                })
    ;
    
  



chart1.render(); //chart rendered at this point
chart2.render(); //chart rendered at this point
chart3.render(); //chart rendered at this point
;



window.onresize = function(){
   chart1.width($("#chart1").width());
   chart1.rescale();
   chart1.redraw();
     
    
   
    chart2.width($("#chart1").width());
   chart2.rescale();
   chart2.redraw();
   ;
    
    
};
        
        






            
        </script>
<!--        <img src="../img/ico.png" alt=""/>-->
        <script>
//Table

$('#alltable').DataTable({
            pageLength: 25,
             "autoWidth": false, //allows bootstrap to manage width by giving table 100% width
//            scrollX:true,
//            scrollY:600,
            searchHighlight: true,
            data: name_dim.top(Infinity),
//            'render': function (data, type, full, meta) {
//      return '<img src="../img/ico.png" style="height:100px;width:100px;"/>';
//                        },
//            language:{thousands:","}, 
            deferRender: true,
            dom: 'Blfrtip',//need this to ensure buttons below work
            buttons: [{extend: 'csv',title:"My table".downloadFileName},
                      {extend: 'excel',title:"My table".downloadFileName}
            ],


// <th>Car</th>
//                                    <th>Max speed</th>
//                                    <th>Colour</th>
//                                    <th>Cost</th>




columns:[
{data:"car",width:"400px"},
{data:"max_speed",width:"400px"},
{data:"colour",width:"400px"},
{data:"cost",width:"400px"},
{data:"Img",width:"400px"}
]
,
"columnDefs": [ {
    "targets": 4,
//       "className": "dt-center", "targets": "_all",
       "className": "dt-center", //makes image center to page
    "data": ds,
    "render": function ( data, type, row, meta ) {
        console.log(data);//always comes up undefined
//      return '<a href="'+data+'">Download</a>';
//console.log(row);//gives you each row in ds as object
//return '<img src="../img/ico.png" style="height:100px;width:100px;"/>';
return '<img src="'+row.img+'" style="width:30px;">';
    }
  } ]

//columnDefs:[
//{title:"Response ID",targets:0},
//{title:"What is the name of your business?",targets:1},
//{title:"Is your business aware of the Economic Partnership Agreement (EPA) that came into force between the EU and Japan in February this year?", targets:2},
//{title:"Which of the following trade related areas best describe the areas of the Economic Partnership Agreement that are  important to your business?",targets:3}
//
//  ]
} );
            
            
        </script>
        
        
        
    </body>
</html>
